import streamlit as st
import pandas as pd
import plotly.express as px
import json
import re
from datetime import datetime, timedelta
import random

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(layout="wide", page_title="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –æ –ì–∞–∑–ø—Ä–æ–º–±–∞–Ω–∫–µ")

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
st.title("–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –æ –ì–∞–∑–ø—Ä–æ–º–±–∞–Ω–∫–µ")

# –°–ª–æ–≤–∞—Ä—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
PRODUCT_CATEGORIES = {
    '–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã –∏ –ø–ª–∞—Ç–µ–∂–∏': [
        '–í–µ–¥–µ–Ω–∏–µ –≤–∞–ª—é—Ç–Ω—ã—Ö —Å—á–µ—Ç–æ–≤',
        '–î–µ–±–µ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã',
        '–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ',
        '–ü–µ—Ä–µ–≤–æ–¥—ã',
        '–ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã',
        '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ'
    ],
    '–°–±–µ—Ä–µ–∂–µ–Ω–∏—è –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è': [
        '–°—Ä–æ—á–Ω—ã–µ –≤–∫–ª–∞–¥—ã',
        '–°–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—á–µ—Ç–∞',
        '–û–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ —Å—á–µ—Ç–∞',
        '–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–µ —Å—á–µ—Ç–∞'
    ],
    '–ö—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏–µ': [
        '–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫—Ä–µ–¥–∏—Ç—ã',
        '–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞',
        '–ò–ø–æ—Ç–µ—á–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã',
        '–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç—ã',
        '–†–µ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ'
    ],
    '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏': [
        '–ë—Ä–æ–∫–µ—Ä—Å–∫–∏–π —Å—á–µ—Ç',
        '–ò–ò–° (–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π —Å—á–µ—Ç)',
        '–ü–ò–§—ã (–ü–∞–µ–≤—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–æ–Ω–¥—ã)',
        '–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã'
    ],
    '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞': [
        '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π',
        '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∏–º—É—â–µ—Å—Ç–≤–∞',
        '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –æ—Ç –Ω–µ—Å—á–∞—Å—Ç–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏ –±–æ–ª–µ–∑–Ω–µ–π',
        '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤'
    ],
    '–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏': [
        '–ü—Ä–∏–≤–∞—Ç –±–∞–Ω–∫–∏–Ω–≥',
        '–î–µ–ø–æ–∑–∏—Ç–∞—Ä–Ω—ã–µ —è—á–µ–π–∫–∏',
        '–£—Å–ª—É–≥–∏ –ø–æ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é'
    ]
}

# –û–±—Ä–∞—Ç–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SUBCAT_TO_CAT = {sub: cat for cat, subs in PRODUCT_CATEGORIES.items() for sub in subs}

# –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
ALL_CATEGORIES = list(PRODUCT_CATEGORIES.keys())
ALL_SUBCATEGORIES = [sub for subs in PRODUCT_CATEGORIES.values() for sub in subs]

# –°–ª–æ–≤–∞—Ä—å –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏ —Ñ—Ä–∞–∑
KEYWORDS = {
    '–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å—ã –∏ –ø–ª–∞—Ç–µ–∂–∏': {
        'keywords': [
            '–¥–µ–±–µ—Ç', '–∫–∞—Ä—Ç', '—Å—á–µ—Ç', '–ø–µ—Ä–µ–≤–æ–¥', '–∑–∞—Ä–ø–ª–∞—Ç', 
            '–º–æ–±–∏–ª—å', '–±–∞–Ω–∫', '–ø–ª–∞—Ç–µ–∂', '–≤–∞–ª—é—Ç', '—Ä—É–±–ª', '–¥–æ–ª–ª–∞—Ä', 
            '–µ–≤—Ä–æ', '—Å–Ω—è—Ç', '–ø–æ–ª—É—á–µ–Ω', '–±–∞–Ω–∫–æ–º–∞—Ç', '–æ–ø–ª–∞—Ç', '–∫–≤–∏—Ç–∞–Ω—Ü',
            '–∫–æ–º–∏—Å—Å', '–æ–±—Å–ª—É–∂–≤–∞–Ω', '–æ—Ç–¥–µ–ª–µ–Ω–∏', '–∫–ª–∏–µ–Ω—Ç', '–æ—á–µ—Ä–µ–¥',
            '–æ–Ω–ª–∞–π–Ω', '–ø—Ä–∏–ª–æ–∂–µ–Ω', '–∏–Ω—Ç–µ—Ä–Ω–µ—Ç', '—Å–º—Å', '—É–≤–µ–¥–æ–º–ª–µ–Ω',
            '—Å—Ä–µ–¥—Å—Ç–≤', '–¥–µ–Ω—å–≥', '–Ω–∞–ª–∏—á', '–±–µ–∑–Ω–∞–ª', '—Å–±–µ—Ä–∫–Ω–∏–∂–∫',
            '–≤—ã–ø–∏—Å', '–±–∞–ª–∞–Ω—Å', '–æ—Å—Ç–∞—Ç–æ–∫',
            '–ø–æ–ø–æ–ª–Ω–µ–Ω', '—Ç–µ—Ä–º–∏–Ω–∞–ª', '–∫–∞—Å—Å', '—á–µ–∫', '—Ä–µ–∫–≤–∏–∑–∏—Ç', 
            '—Å–≤–∏—Ñ—Ç', 'iban', 'bic', 'qr-–∫–æ–¥', 'nfc', '–∫–æ–Ω—Ç–∞–∫—Ç–ª–µ—Å—Å',
            '—ç–ø–ª–ø—ç–π', '–≥—É–≥–ª–ø—ç–π', '—Å–∞–º—Å—É–Ω–≥–ø—ç–π', '–º–∏—Ä–ø—ç–π', '—Ç—Ä–∞–Ω–∑–∞–∫—Ü'
        ],
        'phrases': [
            '–¥–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞', '–∑–∞—Ä–ø–ª–∞—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞', '–º–æ–±–∏–ª—å–Ω—ã–π –±–∞–Ω–∫', 
            '–ø–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥', '–æ—Ç–∫—Ä—ã—Ç—å —Å—á–µ—Ç', '–≤–∞–ª—é—Ç–Ω—ã–π —Å—á–µ—Ç',
            '–±–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á–µ—Ç', '—Ä–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç', '—Å–Ω—è—Ç—å –¥–µ–Ω—å–≥–∏',
            '–ø–æ–ª—É—á–∏—Ç—å –¥–µ–Ω—å–≥–∏', '–æ–ø–ª–∞—Ç–∏—Ç—å —É—Å–ª—É–≥–∏', '–∫–æ–º–∏—Å—Å–∏—è –∑–∞ –ø–µ—Ä–µ–≤–æ–¥',
            '–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã', '–æ—Ç–¥–µ–ª–µ–Ω–∏–µ –±–∞–Ω–∫–∞', '–æ—á–µ—Ä–µ–¥—å –≤ –±–∞–Ω–∫–µ',
            '–∏–Ω—Ç–µ—Ä–Ω–µ—Ç –±–∞–Ω–∫', '–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', '—Å–º—Å –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ',
            '–±–µ–∑–Ω–∞–ª–∏—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç', '–≤—ã–ø–∏—Å–∫–∞ –ø–æ —Å—á–µ—Ç—É', '–æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å—á–µ—Ç–µ',
            '–ø–æ–ø–æ–ª–Ω–∏—Ç—å –∫–∞—Ä—Ç—É', '–ø–ª–∞—Ç–µ–∂–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª', '—á–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ',
            '–±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã', '–º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥', '–±–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –æ–ø–ª–∞—Ç–∞',
            'apple pay', 'google pay', 'samsung pay', 'mir pay', 'qr-–æ–ø–ª–∞—Ç–∞'
        ]
    },
    '–°–±–µ—Ä–µ–∂–µ–Ω–∏—è –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è': {
        'keywords': [
            '–≤–∫–ª–∞–¥', '—Å–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω', '–Ω–∞–∫–æ–ø–∏—Ç', '—Å–±–µ—Ä–µ–∂–µ–Ω', '–º–µ—Ç–∞–ª–ª', 
            '—Å—á–µ—Ç', '—Å—Ä–æ—á–Ω', '–ø—Ä–æ—Ü–µ–Ω—Ç', '–Ω–∞–∫–æ–ø', '—Å–±–µ—Ä–µ–≥', '–¥–µ–ø–æ–∑–∏—Ç',
            '—Å—Ç–∞–≤–∫', '–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç', '–∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü', '–ø–æ–ø–æ–ª–Ω–µ–Ω', '—Å–Ω—è—Ç',
            '–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü', '–ø—Ä–æ—Ü–µ–Ω—Ç—ã', '–Ω–∞—á–∏—Å–ª–µ–Ω', '–∑–∞–±—Ä–∞—Ç', '–ø–æ–ª—É—á–µ–Ω',
            '–∑–æ–ª–æ—Ç', '—Å–µ—Ä–µ–±—Ä', '–ø–ª–∞—Ç–∏–Ω', '–ø–∞–ª–ª–∞–¥', '—Å–ª–∏—Ç–∫',
            '—Å–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω', '—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç', '–Ω–∞–∫–æ–ø–ª–µ–Ω', '–æ—Ç–∫—Ä—ã—Ç', '–∑–∞–∫—Ä—ã—Ç',
            '–∞–∫–∫—É–º—É–ª—è—Ü', '—Ä–µ–∑–µ—Ä–≤', '–∫–æ–ø–∏–ª–∫', '–ø–µ–Ω—Å–∏–æ–Ω', '–¥–µ—Ç—Å–∫', 
            '–Ω–∞—Å–ª–µ–¥', '—Ü–µ–ª–µ–≤–æ', '–µ–∂–µ–º–µ—Å—è—á–Ω', '–∫–≤–∞—Ä—Ç–∞–ª—å–Ω', '–≥–æ–¥–æ–≤'
        ],
        'phrases': [
            '—Å—Ä–æ—á–Ω—ã–π –≤–∫–ª–∞–¥', '—Å–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å—á–µ—Ç', '–º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π —Å—á–µ—Ç',
            '–æ—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥', '–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Å—á–µ—Ç', '–æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–π –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π',
            '–±–∞–Ω–∫–æ–≤—Å–∫–∏–π –≤–∫–ª–∞–¥', '–¥–µ–ø–æ–∑–∏—Ç–Ω—ã–π —Å—á–µ—Ç', '–ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞',
            '–¥–æ—Ö–æ–¥ –ø–æ –≤–∫–ª–∞–¥—É', '–∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤', '–ø–æ–ø–æ–ª–Ω–∏—Ç—å –≤–∫–ª–∞–¥',
            '—Å–Ω—è—Ç—å —Å–æ –≤–∫–ª–∞–¥–∞', '–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è –≤–∫–ª–∞–¥–∞', '–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤',
            '–∑–∞–±—Ä–∞—Ç—å –≤–∫–ª–∞–¥', '–æ—Ç–∫—Ä—ã—Ç—å –¥–µ–ø–æ–∑–∏—Ç', '–∑–æ–ª–æ—Ç–æ–π —Å–ª–∏—Ç–æ–∫',
            '—Å–±–µ—Ä–µ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç', '–Ω–∞–∫–æ–ø–∏—Ç—å –¥–µ–Ω—å–≥–∏',
            '—Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ–¥—É—à–∫–∞', '–ø–µ–Ω—Å–∏–æ–Ω–Ω—ã–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è', '–¥–µ—Ç—Å–∫–∏–π –≤–∫–ª–∞–¥',
            '—Ü–µ–ª–µ–≤–æ–π –¥–µ–ø–æ–∑–∏—Ç', '–µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è', '–≥–æ–¥–æ–≤–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç'
        ]
    },
    '–ö—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏–µ': {
        'keywords': [
            '–∫—Ä–µ–¥–∏—Ç', '–∏–ø–æ—Ç–µ–∫', '–∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç', '—Ä–µ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω', '–∑–∞–µ–º', 
            '–ø–ª–∞—Ç–µ–∂', '–ø—Ä–æ—Ü–µ–Ω—Ç', '—Å—Ç–∞–≤–∫', '–æ–¥–æ–±—Ä–µ–Ω', '–ø–æ–≥–∞—à–µ–Ω', '–≤–∑—è—Ç',
            '–æ—Ñ–æ—Ä–º–ª–µ–Ω', '–¥–æ–ª–≥', '–∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç', '–ø—Ä–æ—Å—Ä–æ—á–∫', '—à—Ç—Ä–∞—Ñ',
            '–ø–µ–Ω–∏', '—Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü', '—Ä–µ—à–µ–Ω', '–æ—Ç–∫–∞–∑', '—É—Å–ª–æ–≤',
            '—Ç—Ä–µ–±–æ–≤–∞–Ω', '—Å–ø—Ä–∞–≤–∫', '–∑–∞—è–≤–∫', '–∞–Ω–∫–µ—Ç', '–∫—Ä–µ–¥–∏—Ç–Ω', '–∏—Å—Ç–æ—Ä–∏',
            '—Å–∫–æ—Ä–∏–Ω–≥', '–ª–∏–º–∏—Ç', '–ª—å–≥–æ—Ç–Ω', '–ø–µ—Ä–∏–æ–¥', '–≥—Ä–∞—Ñ–∏–∫', '–ø–ª–∞—Ç–µ–∂',
            '–æ–≤–µ—Ä–¥—Ä–∞—Ñ—Ç', '–ª–∏–∑–∏–Ω–≥', '—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥', '–≥–∞—Ä–∞–Ω—Ç', '–ø–æ—Ä—É—á–∏—Ç–µ–ª', 
            '–∑–∞–ª–æ–≥', '–∏–ø–æ—Ç–µ—á–Ω', '–∞–≤—Ç–æ', '–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª', '–º–∏–∫—Ä–æ–∑–∞–π–º'
        ],
        'phrases': [
            '–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π –∫—Ä–µ–¥–∏—Ç', '–∏–ø–æ—Ç–µ—á–Ω—ã–π –∫—Ä–µ–¥–∏—Ç', '–≤–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç',
            '–æ—Ñ–æ—Ä–º–∏—Ç—å –∫—Ä–µ–¥–∏—Ç', '–∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞', '—Ä–µ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞',
            '–∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π –∫—Ä–µ–¥–∏—Ç', '–æ–¥–æ–±—Ä–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞', '–ø–æ–≥–∞—à–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞',
            '–∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è', '–ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞', '–µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂',
            '–ª—å–≥–æ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥', '–≥—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π', '–ø—Ä–æ—Å—Ä–æ—á–∫–∞ –ø–ª–∞—Ç–µ–∂–∞',
            '—à—Ç—Ä–∞—Ñ–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏', '—Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –¥–æ–ª–≥–∞', '–æ—Ç–∫–∞–∑ –≤ –∫—Ä–µ–¥–∏—Ç–µ',
            '–∫—Ä–µ–¥–∏—Ç–Ω–∞—è –∑–∞—è–≤–∫–∞', '—Å–ø—Ä–∞–≤–∫–∞ –æ –¥–æ—Ö–æ–¥–∞—Ö', '–∫—Ä–µ–¥–∏—Ç–Ω—ã–π –ª–∏–º–∏—Ç',
            '–æ–≤–µ—Ä–¥—Ä–∞—Ñ—Ç –ø–æ –∫–∞—Ä—Ç–µ', '–ª–∏–∑–∏–Ω–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª—è', '–±–∞–Ω–∫–æ–≤—Å–∫–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è',
            '–∑–∞–ª–æ–≥ –∏–º—É—â–µ—Å—Ç–≤–∞', '–º–∏–∫—Ä–æ–∑–∞–π–º –æ–Ω–ª–∞–π–Ω', '–∫—Ä–µ–¥–∏—Ç –ø–æ–¥ –∑–∞–ª–æ–≥'
        ]
    },
    '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏': {
        'keywords': [
            '–∏–Ω–≤–µ—Å—Ç', '–±—Ä–æ–∫–µ—Ä', '–∏–∏—Å', '–ø–∏—Ñ', '–∞–∫—Ü–∏', '–æ–±–ª–∏–≥–∞—Ü', 
            '–±–∏—Ä–∂', '–ø–æ—Ä—Ç—Ñ–µ–ª—å', '–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç', '—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω', '–ø–∞–π',
            '—Ñ–æ–Ω–¥', '—Ü–µ–Ω–Ω', '–±—É–º–∞–≥', '—Ç–æ—Ä–≥–æ–≤', '—Å–¥–µ–ª–∫', '–∫—É–ø–ª—è',
            '–ø—Ä–æ–¥–∞–∂', '–∫–æ—Ç–∏—Ä–æ–≤–∫', '–¥–∏–≤–∏–¥–µ–Ω–¥', '–∫—É–ø–æ–Ω', '–≤—ã–ø–ª–∞—Ç',
            '—Ä–∏—Å–∫', '–ø—Ä–∏–±—ã–ª', '—É–±—ã—Ç–æ–∫', '–∞–Ω–∞–ª–∏–∑', '—Å–æ–≤–µ—Ç', '—É–ø—Ä–∞–≤–ª–µ–Ω',
            '–∏–Ω–≤–µ—Å—Ç–æ—Ä', '—Ç—Ä–µ–π–¥–µ—Ä', '–ª–∏—Ü–µ–Ω–∑', '–∫–æ–º–∏—Å—Å', '—Ç–∞—Ä–∏—Ñ',
            '—Ñ—å—é—á–µ—Ä—Å', '–æ–ø—Ü–∏–æ–Ω', '—Å–≤–æ–ø', '—Ö–µ–¥–∂', '–¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü', 
            '–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç', '–º–∞—Ä–∂', '–ª–µ–≤–µ—Ä–∏–¥–∂', 'ipo', '—Å–ø–ª–∏—Ç'
        ],
        'phrases': [
            '–±—Ä–æ–∫–µ—Ä—Å–∫–∏–π —Å—á–µ—Ç', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π —Å—á–µ—Ç', '–ø–∞–µ–≤–æ–π —Ñ–æ–Ω–¥',
            '—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç', '–∫—É–ø–∏—Ç—å –∞–∫—Ü–∏–∏', '–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏',
            '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π —Å—á–µ—Ç', '—Ü–µ–Ω–Ω—ã–µ –±—É–º–∞–≥–∏',
            '—Ç–æ—Ä–≥–æ–≤–ª—è –Ω–∞ –±–∏—Ä–∂–µ', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ñ–µ–ª—å', '–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π',
            '–ø–æ–∫—É–ø–∫–∞ –∞–∫—Ü–∏–π', '–ø—Ä–æ–¥–∞–∂–∞ –æ–±–ª–∏–≥–∞—Ü–∏–π', '–¥–∏–≤–∏–¥–µ–Ω–¥–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã',
            '–∫—É–ø–æ–Ω–Ω—ã–π –¥–æ—Ö–æ–¥', '—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π —Ä–∏—Å–∫',
            '–±–∏—Ä–∂–µ–≤—ã–µ —Ç–æ—Ä–≥–∏', '–ª–∏—Ü–µ–Ω–∑–∏—è –±—Ä–æ–∫–µ—Ä–∞', '—Ç–∞—Ä–∏—Ñ—ã –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
            '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è', '—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç–Ω–∏–∫',
            '—Ç–æ—Ä–≥–æ–≤–ª—è —Ñ—å—é—á–µ—Ä—Å–∞–º–∏', '–æ–ø—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã', '–¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è',
            '–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è', 'ipo –∫–æ–º–ø–∞–Ω–∏–∏', '—Å–ø–ª–∏—Ç –∞–∫—Ü–∏–π'
        ]
    },
    '–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞': {
        'keywords': [
            '—Å—Ç—Ä–∞—Ö–æ–≤', '–∑–∞—â–∏—Ç', '–ø—É—Ç–µ—à–µ—Å—Ç–≤', '–∏–º—É—â–µ—Å—Ç–≤', '–Ω–µ—Å—á–∞—Å—Ç–Ω', 
            '—Å–ª—É—á–∞', '–±–æ–ª–µ–∑–Ω', '—Ä–∏—Å–∫', '–ø–æ–ª–∏—Å', '—Å—Ç—Ä–∞—Ö–æ–≤–∫', '–≤—ã–ø–ª–∞—Ç',
            '–∫–æ–º–ø–µ–Ω—Å–∞—Ü', '–¥—Ç–ø', '–∞–≤–∞—Ä–∏—è', '–∑–¥–æ—Ä–æ–≤', '–∂–∏–∑–Ω', '–Ω–µ–¥–≤–∏–∂',
            '–∫–≤–∞—Ä—Ç–∏—Ä', '–¥–æ–º', '–º–∞—à–∏–Ω', '–∞–≤—Ç–æ', '–ª–µ—á–µ–Ω', '–±–æ–ª—å–Ω–∏—á–Ω',
            '–≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü', '–æ–ø–ª–∞—Ç', '–±–æ–ª—å–Ω–∏—Ü', '–ª–µ–∫–∞—Ä—Å—Ç–≤', '—É—â–µ—Ä–±', '–ø–æ–≤—Ä–µ–∂–¥–µ–Ω',
            '–∫—Ä–∞–∂', '–ø–æ–∂–∞—Ä', '–∑–∞—Ç–æ–ø–ª–µ–Ω', '–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç', '–≥—Ä–∞–∂–¥–∞–Ω—Å–∫',
            '–∫–∞—Å–∫–æ', '–æ—Å–∞–≥–æ', '–¥–º—Å', '–≤–∑—Ä', '—Ç—É—Ä–∏—Å—Ç', '–º–µ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫', 
            '—ç–∫—Å—Ç—Ä–µ–Ω', '—ç–≤–∞–∫—É–∞—Ü', '—Ä–µ–ø–∞—Ç—Ä–∏–∞—Ü', '—Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª', '–≤—ã–≥–æ–¥–æ–ø—Ä–∏–æ–±—Ä–µ—Ç–∞—Ç–µ–ª'
        ],
        'phrases': [
            '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤', '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∏–º—É—â–µ—Å—Ç–≤–∞',
            '—Å—Ç—Ä–∞—Ö–æ–≤–æ–π –ø–æ–ª–∏—Å', '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –æ—Ç –Ω–µ—Å—á–∞—Å—Ç–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤',
            '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è', '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–∏', '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã',
            '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è', '—Å—Ç—Ä–∞—Ö–æ–≤–æ–π —Å–ª—É—á–∞–π', '—Å—Ç—Ä–∞—Ö–æ–≤–∞—è –≤—ã–ø–ª–∞—Ç–∞',
            '–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —É—â–µ—Ä–±–∞', '–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–µ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ', '–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ',
            '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏', '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∏–ø–æ—Ç–µ–∫–∏', '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞',
            '—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –≤—ã–µ–∑–∂–∞—é—â–∏—Ö –∑–∞ —Ä—É–±–µ–∂', '—Å—Ç—Ä–∞—Ö–æ–≤–æ–µ –≤–æ–∑–º–µ—â–µ–Ω–∏–µ',
            '–æ—Ñ–æ—Ä–º–∏—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É', '–æ—Ç–∫–∞–∑–∞–ª–∏ –≤ –≤—ã–ø–ª–∞—Ç–µ', '—Å—Ç—Ä–∞—Ö–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è',
            '–∫–∞—Å–∫–æ –Ω–∞ –∞–≤—Ç–æ', '–æ—Å–∞–≥–æ –ø–æ–ª–∏—Å', '–¥–º—Å –ø—Ä–æ–≥—Ä–∞–º–º–∞', '—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤',
            '—ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å', '–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —ç–≤–∞–∫—É–∞—Ü–∏—è', '—Ä–µ–ø–∞—Ç—Ä–∏–∞—Ü–∏—è —Ç–µ–ª–∞'
        ]
    },
    '–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏': {
        'keywords': [
            '–ø—Ä–∏–≤–∞—Ç', '–ø—Ä–µ–º–∏—É–º', '–¥–µ–ø–æ–∑–∏—Ç–∞—Ä', '—è—á–µ–π–∫', '–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω', 
            '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω', '–ø–µ—Ä—Å–æ–Ω–∞–ª', '–º–µ–Ω–µ–¥–∂–µ—Ä', '—ç–∫—Å–∫–ª—é–∑–∏–≤', '–≤–∏–ø',
            '–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω', '–æ–±—Å–ª—É–∂–≤–∞–Ω', '—É—Å–ª—É–≥', '–±–æ–≥–∞—Ç', '—Å–æ—Å—Ç–æ—è–Ω',
            '–∫–∞–ø–∏—Ç–∞–ª', '–Ω–∞—Å–ª–µ–¥', '—Å–æ—Ö—Ä–∞–Ω', '–ø—Ä–∏—É–º–Ω–æ–∂–µ–Ω', '—É–ø—Ä–∞–≤–ª–µ–Ω',
            '–∞–∫—Ç–∏–≤', '—Ü–µ–Ω–Ω–æ—Å—Ç', '–¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω–æ—Å—Ç', '—Ö—Ä–∞–Ω–µ–Ω', '—Å–µ–π—Ñ',
            '–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω', '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω', '–ø–æ–¥—Ö–æ–¥', '—Ä–µ—à–µ–Ω',
            '—Ñ–∏–Ω–∞–Ω—Å–æ–≤', '—Å–æ–≤–µ—Ç', '—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü', '—Å—Ç—Ä–∞—Ç–µ–≥', '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω',
            '—ç–ª–∏—Ç', '–ø—Ä–∏–≤–∏–ª–µ–≥–∏', '–ª–∞—É–Ω–∂', '–∫–æ–Ω—Å—å–µ—Ä–∂', '–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç', 
            '—Å–µ–º–µ–π–Ω', '—Ç—Ä–∞—Å—Ç', '–æ—Ñ—Ñ—à–æ—Ä', '–Ω–∞–ª–æ–≥–æ–≤', '–æ–ø—Ç–∏–º–∏–∑–∞—Ü', '—Ñ–∏–ª–∞–Ω—Ç—Ä–æ–ø'
        ],
        'phrases': [
            '–ø—Ä–∏–≤–∞—Ç –±–∞–Ω–∫–∏–Ω–≥', '–¥–µ–ø–æ–∑–∏—Ç–∞—Ä–Ω–∞—è —è—á–µ–π–∫–∞', '—Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ',
            '–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä', '–ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ', '–≤–∏–ø –∫–ª–∏–µ–Ω—Ç',
            '–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥', '—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º', '—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–æ–≥–∞—Ç—Å—Ç–≤–∞',
            '–ø—Ä–∏—É–º–Ω–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è', '—Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', '–±–∞–Ω–∫–æ–≤—Å–∫–∞—è —è—á–µ–π–∫–∞',
            '—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π', '—Å–µ–π—Ñ–æ–≤–∞—è —è—á–µ–π–∫–∞', '–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
            '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è', '–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞', '—ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã',
            '–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è', '—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∞–º–∏', '—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç',
            '—ç–ª–∏—Ç–Ω—ã–π –∫–ª—É–±', '–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –≤–∏–ø', '–∫–æ–Ω—Å—å–µ—Ä–∂ —Å–µ—Ä–≤–∏—Å', '–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
            '—Å–µ–º–µ–π–Ω—ã–π –æ—Ñ–∏—Å', '—Ç—Ä–∞—Å—Ç–æ–≤—ã–π —Ñ–æ–Ω–¥', '–Ω–∞–ª–æ–≥–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è', '–æ—Ñ—Ñ—à–æ—Ä–Ω—ã–µ —Å—á–µ—Ç–∞'
        ]
    }
}

# –õ–µ–∫—Å–∏–∫–æ–Ω —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
SENTIMENT_LEXICON = {
    'positive': {
        '–æ—Ç–ª–∏—á–Ω': 2, '—Ö–æ—Ä–æ—à': 2, '–ø—Ä–µ–∫—Ä–∞—Å–Ω': 2, '–±—ã—Å—Ç—Ä': 1, '—É–¥–æ–±–Ω': 1, '–ø–æ–Ω—è—Ç–Ω': 1,
        '—Ä–µ–∫–æ–º–µ–Ω–¥': 2, '–¥–æ–≤–æ–ª': 2, '—Å–ø–∞—Å–∏–±': 2, '—Ä–∞–¥': 2, '–ª–µ–≥–∫': 1, '–ø—Ä–∏—è—Ç–Ω': 1,
        '–∫–∞—á–µ—Å—Ç–≤–µ–Ω': 2, '–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª': 2, '–æ–ø–µ—Ä–∞—Ç–∏–≤': 1, '—á–µ—Ç–∫': 1, '–ø—Ä–æ–∑—Ä–∞—á–Ω': 1,
        '–≤—ã–≥–æ–¥–Ω': 2, '–Ω–∞–¥–µ–∂–Ω': 2, '–ª—É—á—à': 2, '—Å—É–ø–µ—Ä': 2, '–∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω': 2, '–≤–ø–µ—á–∞—Ç–ª': 2,
        '—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω': 2, '–ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å': 2, '–Ω—Ä–∞–≤–∏—Ç—Å—è': 2, '–≤–æ–≤—Ä–µ–º—è': 1, '—Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω': 1,
        '–≥–ª–∞–¥–∫–æ': 1, '—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω': 1, '–±–µ–∑ –ø—Ä–æ–±–ª–µ–º': 2, '–Ω–µ –ø–ª–æ—Ö–æ': 1, '–±–µ–∑ –æ—à–∏–±–æ–∫': 2,
    },
    'negative': {
        '–ø–ª–æ—Ö': -2, '—É–∂–∞—Å–Ω': -3, '–º–µ–¥–ª–µ–Ω': -2, '–Ω–µ—É–¥–æ–±–Ω': -2, '—Å–ª–æ–∂–Ω': -2, '–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è': -3,
        '–ø—Ä–æ–±–ª–µ–º': -2, '–æ—à–∏–±–∫': -2, '–≥–ª—é–∫': -2, '–∑–∞–≤–∏—Å–∞': -2, '–Ω–µ —Ä–∞–±–æ—Ç': -3, '–æ—Ç–∫–∞–∑': -2,
        '–æ–±–º–∞–Ω': -3, '–¥–æ—Ä–æ–≥': -2, '–∫–æ–º–∏—Å—Å': -1, '–¥–æ–ª–≥': -2, '–Ω–µ—è—Å–Ω': -1, '–Ω–µ–ø–æ–ª–∞–¥–∫': -2,
        '–Ω–µ–¥–æ–≤–æ–ª': -2, '—Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω': -3, '–∫–æ—à–º–∞—Ä': -3, '–∑–∞–≤–∏—Å–∞–µ—Ç': -2, '–≤–∏—Å–Ω–µ—Ç': -2, '—Ç—É–ø–∏—Ç': -2,
        '–ª–∞–≥–∞–µ—Ç': -2, '–º–∞–ª–µ–Ω—å–∫': -1
    }
}

NEGATION_WORDS = {'–Ω–µ', '–Ω–µ—Ç', '–Ω–∏', '–±–µ–∑', '–Ω–µ–ª—å–∑—è', '–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ', '–Ω–∏–∫–∞–∫', '–Ω–∏—á—É—Ç—å'}

def classify_sentiment(text):
    text = text.lower()
    score = 0
    words = re.findall(r'\w+', text)
    for i, word in enumerate(words):
        for sentiment, lex in SENTIMENT_LEXICON.items():
            for key, val in lex.items():
                if key in word:
                    adjusted_val = val
                    if i > 0 and words[i-1] in NEGATION_WORDS:
                        adjusted_val = -adjusted_val
                    score += adjusted_val
                    break
    if score > 0.5:
        return '–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ'
    elif score < -0.5:
        return '–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ'
    else:
        return '–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ'

def extract_topic_from_fragment(fragment):
    fragment = fragment.lower()
    words = set(re.findall(r'\w+', fragment))
    
    for category, data in KEYWORDS.items():
        if any(kw in fragment for kw in data['phrases']) or any(w in words for w in data['keywords']):
            return category
    
    return '–î—Ä—É–≥–æ–µ'

def random_review_date():
    start = datetime(2024, 1, 1)
    end = datetime(2025, 5, 31)
    delta = end - start
    random_days = random.randrange(delta.days + 1)
    return (start + timedelta(days=random_days)).strftime('%d.%m.%Y')

def process_review(review):
    text = review.get('text', '')
    id = review.get('id', 0)
    
    parts = re.split(r'\b(–Ω–æ|–∑–∞—Ç–æ|–æ–¥–Ω–∞–∫–æ|–∞ —Ç–∞–∫–∂–µ|–ø—Ä–∏ —ç—Ç–æ–º|–∏|–Ω–æ –ø—Ä–∏ —ç—Ç–æ–º)\b', text, flags=re.IGNORECASE)
    fragments = []
    for i in range(0, len(parts), 2):
        frag = parts[i].strip()
        if i + 1 < len(parts):
            frag += ' ' + parts[i+1].strip()
        if frag:
            fragments.append(frag.strip())
    
    if not fragments:
        fragments = [text]
    
    topics = []
    sentiments = []
    
    for frag in fragments:
        topic = extract_topic_from_fragment(frag)
        if topic == '–î—Ä—É–≥–æ–µ' and len(fragments) > 1:
            continue
        sentiment = classify_sentiment(frag)
        topics.append(topic)
        sentiments.append(sentiment)
    
    if all(t == '–î—Ä—É–≥–æ–µ' for t in topics):
        topics = ['–î—Ä—É–≥–æ–µ']
        sentiments = [classify_sentiment(text)]
    
    unique = list(dict.fromkeys(zip(topics, sentiments)))
    topics, sentiments = zip(*unique) if unique else (['–î—Ä—É–≥–æ–µ'], [classify_sentiment(text)])
    
    if len(set(sentiments)) > 1:
        rating = 3
    else:
        first_sent = sentiments[0]
        if first_sent == '–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ':
            rating = 5
        elif first_sent == '–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ':
            rating = 1
        else:
            rating = 3
    
    return {
        'id': id,
        'text': text,
        'topics': ', '.join(topics),
        'sentiments': ', '.join(sentiments),
        'product_category': ', '.join(topics),
        'date': random_review_date(),
        'rating': rating,
        'author': review.get('author', '–ö–ª–∏–µ–Ω—Ç –±–∞–Ω–∫–∞'),
        'source': 'gold'
    }

@st.cache_data
def load_data(uploaded_file):
    if uploaded_file is not None:
        try:
            data = json.load(uploaded_file)
            if 'data' in data and isinstance(data['data'], list):
                predictions = [process_review(review) for review in data['data']]
                df = pd.DataFrame(predictions)
                if not df.empty:
                    df['date'] = pd.to_datetime(df['date'], format='%d.%m.%Y')
                    st.info(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(df)} –æ—Ç–∑—ã–≤–æ–≤")
                    return df
        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ JSON: {e}")
    st.error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON. –û–∂–∏–¥–∞–µ—Ç—Å—è {'data': [{'id': 1, 'text': '...'}]}")
    return pd.DataFrame()

# –°–∞–π–¥–±–∞—Ä
st.sidebar.header("–ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä—ã")
uploaded_json = st.sidebar.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Å –æ—Ç–∑—ã–≤–∞–º–∏", type=['json'])

if uploaded_json:
    df = load_data(uploaded_json)
    if not df.empty:
        st.sidebar.header("–§–∏–ª—å—Ç—Ä—ã")
        min_date = df['date'].min().date()
        max_date = df['date'].max().date()
        start_date = st.sidebar.date_input("–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞", min_date, min_value=min_date, max_value=max_date)
        end_date = st.sidebar.date_input("–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞", max_date, min_value=min_date, max_value=max_date)

        rating_filter = st.sidebar.slider("–†–µ–π—Ç–∏–Ω–≥", min_value=1, max_value=5, value=(1, 5))

        selected_categories = st.sidebar.multiselect("–ö–∞—Ç–µ–≥–æ—Ä–∏–∏", options=ALL_CATEGORIES, default=[])

        if selected_categories:
            if len(selected_categories) == 1:
                available_subcategories = PRODUCT_CATEGORIES[selected_categories[0]]
                selected_subcategories = st.sidebar.multiselect("–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏", options=available_subcategories, default=[])
            else:
                selected_subcategories = []
        else:
            selected_subcategories = []

        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        mask = (df['date'].dt.date >= start_date) & (df['date'].dt.date <= end_date) & (df['rating'].between(*rating_filter))
        
        if selected_categories:
            mask &= df['product_category'].str.contains('|'.join(selected_categories), case=False, na=False)
        if selected_subcategories:
            mask &= df['product_category'].str.contains('|'.join(selected_subcategories), case=False, na=False)

        filtered_df = df[mask].copy()

        # –í—ã–≤–æ–¥
        st.subheader("üìù –ü–æ–¥—Ä–æ–±–Ω—ã–µ –æ—Ç–∑—ã–≤—ã")
        st.dataframe(filtered_df[['id', 'text', 'topics', 'sentiments', 'rating', 'date']])

        # –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
        st.subheader("üòä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏")
        if not filtered_df.empty:
            exploded = filtered_df.copy()
            exploded['sentiments_list'] = exploded['sentiments'].str.split(', ')
            exploded = exploded.explode('sentiments_list')
            sentiment_counts = exploded['sentiments_list'].value_counts()
            fig_sentiment = px.pie(
                names=sentiment_counts.index,
                values=sentiment_counts.values,
                title="–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–∑—ã–≤–æ–≤",
                color=sentiment_counts.index,
                color_discrete_map={'–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ': '#90EE90', '–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ': '#FF6347', '–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ': '#D3D3D3'}
            )
            st.plotly_chart(fig_sentiment, use_container_width=True)

        # –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        st.subheader("üìã –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ø—Ä–æ–¥—É–∫—Ç–æ–≤")
        if not filtered_df.empty:
            exploded_cat = filtered_df.copy()
            exploded_cat['cat_list'] = exploded_cat['product_category'].str.split(', ')
            exploded_cat = exploded_cat.explode('cat_list')
            if not selected_categories or len(selected_categories) > 1:
                # –ê–≥—Ä–µ–≥–∏—Ä—É–µ–º –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –±–µ–∑ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
                exploded_cat['cat_list'] = exploded_cat['cat_list'].apply(lambda x: SUBCAT_TO_CAT.get(x.strip(), x) if x in ALL_SUBCATEGORIES else x)
                cat_counts = exploded_cat['cat_list'].value_counts().loc[ALL_CATEGORIES]
            else:
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ–¥–Ω–æ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                cat_counts = exploded_cat['cat_list'].value_counts()
            fig_cat = px.bar(
                x=cat_counts.index,
                y=cat_counts.values,
                title="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
                labels={'x': '–¢–µ–º–∞', 'y': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤'},
                color=cat_counts.index,
                color_discrete_sequence=px.colors.qualitative.Plotly
            )
            st.plotly_chart(fig_cat, use_container_width=True)

        # –î–∏–Ω–∞–º–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ –¥–∞—Ç–∞–º
        st.subheader("üìÖ –î–∏–Ω–∞–º–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ –¥–∞—Ç–∞–º (–ø–æ —Ç–µ–º–∞–º)")
        if not filtered_df.empty:
            exploded_df = filtered_df.assign(topic=filtered_df['topics'].str.split(', ')).explode('topic')
            if not selected_categories or len(selected_categories) > 1:
                # –ê–≥—Ä–µ–≥–∏—Ä—É–µ–º –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –±–µ–∑ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
                exploded_df['topic'] = exploded_df['topic'].apply(lambda x: SUBCAT_TO_CAT.get(x.strip(), x) if x in ALL_SUBCATEGORIES else x)
                count_by_date_topic = exploded_df.groupby(['date_str', 'topic']).size().reset_index(name='count')
                count_by_date_topic = count_by_date_topic[count_by_date_topic['topic'].isin(ALL_CATEGORIES)]
            else:
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ–¥–Ω–æ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                exploded_df['date_str'] = exploded_df['date'].dt.date.astype(str)
                count_by_date_topic = exploded_df.groupby(['date_str', 'topic']).size().reset_index(name='count')
            fig_date = px.line(
                count_by_date_topic,
                x='date_str',
                y='count',
                color='topic',
                title="–î–∏–Ω–∞–º–∏–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ –¥–∞—Ç–∞–º –∏ —Ç–µ–º–∞–º",
                labels={'date_str': '–î–∞—Ç–∞', 'count': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤', 'topic': '–¢–µ–º–∞'},
                color_discrete_sequence=px.colors.qualitative.Plotly
            )
            st.plotly_chart(fig_date, use_container_width=True)
    else:
        st.write("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.")
else:
    st.sidebar.warning("–ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Å –æ—Ç–∑—ã–≤–∞–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞")
    st.write("–ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Å –æ—Ç–∑—ã–≤–∞–º–∏ –≤ —Å–∞–π–¥–±–∞—Ä–µ.")
